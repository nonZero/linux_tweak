#!/bin/sh
#this file should be located at /etc/acpi
#do not forget to do $sudo chmod +x /etc/acpi/power.sh

if on_ac_power; then
#disbling laptop_mode
  echo 0 > /proc/sys/vm/laptop_mode
#Percentage of max dirty data before flushing on HDD/SSD
  echo 10 > /proc/sys/vm/dirty_ratio
#Percentage of all dirty date allowed
  echo 5 > /proc/sys/vm/dirty_background_ratio
#How often to check whether dirty data should be written on HDD/SSD (cs)
  echo 6000 > /proc/sys/vm/dirty_writeback_centisecs
#diable Intel HDA power saving
  echo 0 > /sys/module/snd_hda_intel/parameters/power_save
#Max Performance for SATA devices
  echo max_performance > /sys/class/scsi_host/host0/link_power_management_policy
  echo max_performance > /sys/class/scsi_host/host1/link_power_management_policy
  echo max_performance > /sys/class/scsi_host/host2/link_power_management_policy
  echo max_performance > /sys/class/scsi_host/host3/link_power_management_policy
  echo max_performance > /sys/class/scsi_host/host4/link_power_management_policy
  echo max_performance > /sys/class/scsi_host/host5/link_power_management_policy
#Set CPU governor on AC
  echo conservative > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
  echo conservative > /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
  echo conservative > /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
  echo conservative > /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor 
#Power Saving off for PCI Express link
  echo default > /sys/module/pcie_aspm/parameters/policy
#set brightness level on AC
  echo 15 | tee /sys/class/backlight/acpi_video1/brightness
#
  hal-disable-polling --enable-polling --device /dev/cdrom
#disbale multiple core powersaving
  echo 0 > /sys/devices/system/cpu/sched_mc_power_savings
else
#enable laptop_mode
  echo 5 > /proc/sys/vm/laptop_mode
#set dirty data ratio
  echo 90 > /proc/sys/vm/dirty_ratio
  echo 1 > /proc/sys/vm/dirty_background_ratio
  echo 60000 > /proc/sys/vm/dirty_writeback_centisecs
#enable Intel HDA power saving
  echo 10 > /sys/module/snd_hda_intel/parameters/power_save
#Power saving on for SATA devices
  echo min_power > /sys/class/scsi_host/host0/link_power_management_policy
  echo min_power > /sys/class/scsi_host/host1/link_power_management_policy
  echo min_power > /sys/class/scsi_host/host2/link_power_management_policy
  echo min_power > /sys/class/scsi_host/host3/link_power_management_policy
  echo min_power > /sys/class/scsi_host/host4/link_power_management_policy
  echo min_power > /sys/class/scsi_host/host5/link_power_management_policy
#set CPU governor for all CPUs on Battery
  echo ondemand > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
  echo ondemand > /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor
  echo ondemand > /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor
  echo ondemand > /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor
#Power saving for PCI Express link
  echo powersave > /sys/module/pcie_aspm/parameters/policy
#set brightness level on Battery
echo 7 | tee /sys/class/backlight/acpi_video1/brightness
#diable cd drive polling
  hal-disable-polling --device /dev/cdrom
#enable multiple core power saving
  echo 1 > /sys/devices/system/cpu/sched_mc_power_savings
fi
